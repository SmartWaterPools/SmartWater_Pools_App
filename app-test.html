<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartWater Pools - Application Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.5;
      color: #334155;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f0f9ff;
    }
    header {
      background-color: #0c4a6e;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      text-align: center;
    }
    h1 {
      margin: 0;
      font-size: 2rem;
    }
    h2 {
      color: #0369a1;
      margin-top: 30px;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 10px;
    }
    .card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    .card h3 {
      color: #0c4a6e;
      margin-top: 0;
      margin-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 10px;
    }
    .button {
      background-color: #0284c7;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 16px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
      text-decoration: none;
      display: inline-block;
      margin: 5px 0;
    }
    .button:hover {
      background-color: #0369a1;
    }
    .button.secondary {
      background-color: #f1f5f9;
      color: #0c4a6e;
      border: 1px solid #cbd5e1;
    }
    .button.secondary:hover {
      background-color: #e2e8f0;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    pre {
      background-color: #f1f5f9;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 14px;
      margin: 15px 0;
    }
    .result {
      background-color: #f8fafc;
      border-left: 4px solid #0284c7;
      padding: 15px;
      margin: 15px 0;
      font-size: 14px;
      display: none;
    }
    .status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .status.success {
      background-color: #dcfce7;
      color: #166534;
    }
    .status.error {
      background-color: #fee2e2;
      color: #991b1b;
    }
    .status.warning {
      background-color: #fef3c7;
      color: #92400e;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #0c4a6e;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #cbd5e1;
      border-radius: 4px;
      margin-bottom: 15px;
      font-family: inherit;
      font-size: 14px;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    .section {
      margin-bottom: 30px;
    }
    footer {
      margin-top: 50px;
      padding-top: 20px;
      border-top: 1px solid #e2e8f0;
      text-align: center;
      color: #64748b;
      font-size: 14px;
    }
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(3, 105, 161, 0.3);
      border-radius: 50%;
      border-top-color: #0369a1;
      animation: spin 1s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    .hidden {
      display: none;
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid #e2e8f0;
    }
    .tab {
      padding: 10px 20px;
      background-color: #f8fafc;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
      margin-right: 5px;
      border-top-left-radius: 4px;
      border-top-right-radius: 4px;
    }
    .tab.active {
      background-color: #0284c7;
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <h1>SmartWater Pools Management System</h1>
    <p>Application Functionality Test</p>
  </header>

  <div class="tabs">
    <button class="tab active" onclick="openTab(event, 'basicTests')">Basic Tests</button>
    <button class="tab" onclick="openTab(event, 'apiTests')">API Tests</button>
    <button class="tab" onclick="openTab(event, 'dataTests')">Data Tests</button>
    <button class="tab" onclick="openTab(event, 'viewsTest')">View Tests</button>
  </div>

  <div id="basicTests" class="tab-content active">
    <div class="section">
      <h2>Server Connection Tests</h2>
      <div class="grid">
        <div class="card">
          <h3>Health Check</h3>
          <p>Verify the server is running and healthy.</p>
          <button class="button" onclick="testHealth()">Run Test</button>
          <div id="healthResult" class="result"></div>
        </div>
        
        <div class="card">
          <h3>Database Connection</h3>
          <p>Verify connection to the database.</p>
          <button class="button" onclick="testDatabase()">Run Test</button>
          <div id="dbResult" class="result"></div>
        </div>
        
        <div class="card">
          <h3>Frontend Assets</h3>
          <p>Check if frontend assets are loading correctly.</p>
          <button class="button" onclick="testAssets()">Run Test</button>
          <div id="assetsResult" class="result"></div>
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2>Environment Tests</h2>
      <div class="grid">
        <div class="card">
          <h3>Environment Variables</h3>
          <p>Check environment configuration.</p>
          <button class="button" onclick="testEnvironment()">Run Test</button>
          <div id="envResult" class="result"></div>
        </div>
        
        <div class="card">
          <h3>External Integrations</h3>
          <p>Test Google Maps API integration.</p>
          <button class="button" onclick="testMapsIntegration()">Run Test</button>
          <div id="mapsResult" class="result"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="apiTests" class="tab-content">
    <div class="section">
      <h2>API Tests</h2>
      
      <div class="card">
        <h3>Test API Endpoints</h3>
        <label for="apiEndpoint">Select Endpoint</label>
        <select id="apiEndpoint">
          <option value="/api/health">Health Check (/api/health)</option>
          <option value="/api/users">Users (/api/users)</option>
          <option value="/api/clients">Clients (/api/clients)</option>
          <option value="/api/technicians">Technicians (/api/technicians)</option>
          <option value="/api/projects">Projects (/api/projects)</option>
          <option value="/api/maintenances">Maintenances (/api/maintenances)</option>
          <option value="/api/repairs">Repairs (/api/repairs)</option>
          <option value="/api/invoices">Invoices (/api/invoices)</option>
          <option value="/api/dashboard/summary">Dashboard Summary (/api/dashboard/summary)</option>
        </select>
        <button class="button" onclick="testApiEndpoint()">Test Endpoint</button>
        <div class="loader hidden" id="apiLoader"></div>
        <div id="apiResult" class="result"></div>
      </div>
      
      <div class="card">
        <h3>Custom API Request</h3>
        <label for="customEndpoint">Endpoint URL</label>
        <input type="text" id="customEndpoint" placeholder="/api/...">
        
        <label for="requestMethod">Method</label>
        <select id="requestMethod">
          <option value="GET">GET</option>
          <option value="POST">POST</option>
          <option value="PATCH">PATCH</option>
          <option value="DELETE">DELETE</option>
        </select>
        
        <label for="requestBody">Request Body (JSON)</label>
        <textarea id="requestBody" placeholder='{
  "key": "value"
}'></textarea>
        
        <button class="button" onclick="testCustomEndpoint()">Send Request</button>
        <div class="loader hidden" id="customApiLoader"></div>
        <div id="customApiResult" class="result"></div>
      </div>
    </div>
  </div>

  <div id="dataTests" class="tab-content">
    <div class="section">
      <h2>Data Tests</h2>
      
      <div class="card">
        <h3>Basic Data Queries</h3>
        <button class="button" onclick="testUsersData()">Test Users</button>
        <button class="button" onclick="testClientsData()">Test Clients</button>
        <button class="button" onclick="testTechniciansData()">Test Technicians</button>
        <div id="dataResult" class="result"></div>
      </div>
      
      <div class="card">
        <h3>Business Data Integrity</h3>
        <p>Verify relationships between entities.</p>
        <button class="button" onclick="testRelationships()">Test Relationships</button>
        <div id="relationshipsResult" class="result"></div>
      </div>
      
      <div class="card">
        <h3>Dashboard Data</h3>
        <p>Verify dashboard summary data.</p>
        <button class="button" onclick="testDashboardData()">Test Dashboard</button>
        <div id="dashboardResult" class="result"></div>
      </div>
    </div>
  </div>

  <div id="viewsTest" class="tab-content">
    <div class="section">
      <h2>View Tests</h2>
      
      <div class="card">
        <h3>Main Application</h3>
        <p>Open the main application in a new window.</p>
        <a href="/" class="button" target="_blank">Open Application</a>
      </div>
      
      <div class="card">
        <h3>Diagnostic Tool</h3>
        <p>Open the diagnostic tool.</p>
        <a href="/diagnostic" class="button" target="_blank">Open Diagnostic</a>
      </div>
    </div>
  </div>

  <footer>
    <p>SmartWater Pools Management System - Application Test Page</p>
    <p>Version 1.0.0 | Current date: <span id="currentDate"></span></p>
  </footer>

  <script>
    // Set current date
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString();
    
    // Tab functionality
    function openTab(evt, tabName) {
      const tabcontents = document.getElementsByClassName('tab-content');
      for (let i = 0; i < tabcontents.length; i++) {
        tabcontents[i].classList.remove('active');
      }
      
      const tabs = document.getElementsByClassName('tab');
      for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
      }
      
      document.getElementById(tabName).classList.add('active');
      evt.currentTarget.classList.add('active');
    }
    
    // Health check test
    async function testHealth() {
      const resultDiv = document.getElementById('healthResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing server health...';
      
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        
        resultDiv.innerHTML = `
          <span class="status success">Success</span>
          <p>Server is ${data.status}</p>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to connect to server: ${error.message}</p>
        `;
      }
    }
    
    // Database connection test
    async function testDatabase() {
      const resultDiv = document.getElementById('dbResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing database connection...';
      
      try {
        // We'll test by fetching users since it's a simple endpoint that requires DB
        const response = await fetch('/api/users');
        const data = await response.json();
        
        resultDiv.innerHTML = `
          <span class="status success">Success</span>
          <p>Database connection successful. ${data.length} users found.</p>
          <pre>Sample data: ${JSON.stringify(data.slice(0, 2), null, 2)}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to connect to database: ${error.message}</p>
        `;
      }
    }
    
    // Frontend assets test
    async function testAssets() {
      const resultDiv = document.getElementById('assetsResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing frontend assets...';
      
      try {
        // Test main HTML page load
        const htmlResponse = await fetch('/');
        const htmlStatus = htmlResponse.status;
        
        // We'll assume the main JS file is at the root
        const jsResponse = await fetch('/assets/index.js').catch(() => ({ ok: false }));
        const jsStatus = jsResponse.ok;
        
        // We'll assume the main CSS file is at the root
        const cssResponse = await fetch('/assets/index.css').catch(() => ({ ok: false }));
        const cssStatus = cssResponse.ok;
        
        const allOk = htmlStatus === 200 && jsStatus && cssStatus;
        
        if (allOk) {
          resultDiv.innerHTML = `
            <span class="status success">Success</span>
            <p>All frontend assets are loading correctly.</p>
            <ul>
              <li>HTML: Status ${htmlStatus}</li>
              <li>JavaScript: ${jsStatus ? 'Loaded' : 'Failed'}</li>
              <li>CSS: ${cssStatus ? 'Loaded' : 'Failed'}</li>
            </ul>
          `;
        } else {
          resultDiv.innerHTML = `
            <span class="status warning">Warning</span>
            <p>Some assets may not be loading correctly:</p>
            <ul>
              <li>HTML: Status ${htmlStatus}</li>
              <li>JavaScript: ${jsStatus ? 'Loaded' : 'Failed'}</li>
              <li>CSS: ${cssStatus ? 'Loaded' : 'Failed'}</li>
            </ul>
            <p>Note: This test may not be accurate as it depends on the specific asset paths.</p>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to test assets: ${error.message}</p>
        `;
      }
    }
    
    // Environment test
    async function testEnvironment() {
      const resultDiv = document.getElementById('envResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing environment configuration...';
      
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        
        resultDiv.innerHTML = `
          <span class="status success">Success</span>
          <p>Environment information:</p>
          <ul>
            <li>Environment: ${data.environment || 'Not specified'}</li>
            <li>Database: ${data.database || 'Not specified'}</li>
            <li>Node Version: ${data.nodeVersion || 'Not specified'}</li>
            <li>Memory: ${data.memory ? `${data.memory.heapUsed} / ${data.memory.heapTotal}` : 'Not specified'}</li>
            <li>Server Uptime: ${data.uptime || 'Not specified'}</li>
          </ul>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to get environment information: ${error.message}</p>
        `;
      }
    }
    
    // Maps API integration test
    async function testMapsIntegration() {
      const resultDiv = document.getElementById('mapsResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing Google Maps API integration...';
      
      try {
        const response = await fetch('/api/google-maps-key');
        const data = await response.json();
        
        if (data.apiKey) {
          resultDiv.innerHTML = `
            <span class="status success">Success</span>
            <p>Google Maps API key is configured.</p>
            <p>Key: ${data.apiKey.substring(0, 10)}...</p>
          `;
        } else {
          resultDiv.innerHTML = `
            <span class="status warning">Warning</span>
            <p>Google Maps API key is not properly configured.</p>
            <p>Response: ${JSON.stringify(data)}</p>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to check Maps API integration: ${error.message}</p>
        `;
      }
    }
    
    // API endpoint test
    async function testApiEndpoint() {
      const endpoint = document.getElementById('apiEndpoint').value;
      const resultDiv = document.getElementById('apiResult');
      const loader = document.getElementById('apiLoader');
      
      resultDiv.style.display = 'block';
      loader.classList.remove('hidden');
      resultDiv.innerHTML = `Testing endpoint: ${endpoint}...`;
      
      try {
        const startTime = performance.now();
        const response = await fetch(endpoint);
        const endTime = performance.now();
        const responseTime = (endTime - startTime).toFixed(2);
        
        const data = await response.json();
        
        resultDiv.innerHTML = `
          <span class="status success">Success (${responseTime}ms)</span>
          <p>Status: ${response.status} ${response.statusText}</p>
          <p>Content Type: ${response.headers.get('content-type')}</p>
          <pre>${JSON.stringify(data, null, 2).substring(0, 1000)}${JSON.stringify(data, null, 2).length > 1000 ? '...' : ''}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to test endpoint: ${error.message}</p>
        `;
      } finally {
        loader.classList.add('hidden');
      }
    }
    
    // Custom API request
    async function testCustomEndpoint() {
      const endpoint = document.getElementById('customEndpoint').value;
      const method = document.getElementById('requestMethod').value;
      const bodyText = document.getElementById('requestBody').value;
      
      const resultDiv = document.getElementById('customApiResult');
      const loader = document.getElementById('customApiLoader');
      
      resultDiv.style.display = 'block';
      loader.classList.remove('hidden');
      resultDiv.innerHTML = `Sending ${method} request to ${endpoint}...`;
      
      let body = null;
      let headers = {};
      
      if (bodyText && (method === 'POST' || method === 'PATCH')) {
        try {
          body = JSON.parse(bodyText);
          headers = {
            'Content-Type': 'application/json'
          };
        } catch (e) {
          resultDiv.innerHTML = `
            <span class="status error">Error</span>
            <p>Invalid JSON in request body: ${e.message}</p>
          `;
          loader.classList.add('hidden');
          return;
        }
      }
      
      try {
        const startTime = performance.now();
        const response = await fetch(endpoint, {
          method,
          headers,
          body: body ? JSON.stringify(body) : undefined
        });
        const endTime = performance.now();
        const responseTime = (endTime - startTime).toFixed(2);
        
        let data;
        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
          data = await response.json();
          resultDiv.innerHTML = `
            <span class="status ${response.ok ? 'success' : 'error'}">Status: ${response.status} (${responseTime}ms)</span>
            <p>Response Headers:</p>
            <pre>${Array.from(response.headers.entries()).map(([key, value]) => `${key}: ${value}`).join('\n')}</pre>
            <p>Response Body:</p>
            <pre>${JSON.stringify(data, null, 2).substring(0, 1000)}${JSON.stringify(data, null, 2).length > 1000 ? '...' : ''}</pre>
          `;
        } else {
          const text = await response.text();
          resultDiv.innerHTML = `
            <span class="status ${response.ok ? 'success' : 'error'}">Status: ${response.status} (${responseTime}ms)</span>
            <p>Response Headers:</p>
            <pre>${Array.from(response.headers.entries()).map(([key, value]) => `${key}: ${value}`).join('\n')}</pre>
            <p>Response Body (text):</p>
            <pre>${text.substring(0, 1000)}${text.length > 1000 ? '...' : ''}</pre>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to send request: ${error.message}</p>
        `;
      } finally {
        loader.classList.add('hidden');
      }
    }
    
    // Test Users Data
    async function testUsersData() {
      const resultDiv = document.getElementById('dataResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing users data...';
      
      try {
        const response = await fetch('/api/users');
        const data = await response.json();
        
        if (Array.isArray(data) && data.length > 0) {
          resultDiv.innerHTML = `
            <span class="status success">Success</span>
            <p>${data.length} users found.</p>
            <pre>${JSON.stringify(data.slice(0, 2), null, 2)}</pre>
          `;
        } else {
          resultDiv.innerHTML = `
            <span class="status warning">Warning</span>
            <p>No users found or invalid data format.</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to test users data: ${error.message}</p>
        `;
      }
    }
    
    // Test Clients Data
    async function testClientsData() {
      const resultDiv = document.getElementById('dataResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing clients data...';
      
      try {
        const response = await fetch('/api/clients');
        const data = await response.json();
        
        if (Array.isArray(data) && data.length > 0) {
          resultDiv.innerHTML = `
            <span class="status success">Success</span>
            <p>${data.length} clients found.</p>
            <pre>${JSON.stringify(data.slice(0, 1), null, 2)}</pre>
          `;
        } else {
          resultDiv.innerHTML = `
            <span class="status warning">Warning</span>
            <p>No clients found or invalid data format.</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to test clients data: ${error.message}</p>
        `;
      }
    }
    
    // Test Technicians Data
    async function testTechniciansData() {
      const resultDiv = document.getElementById('dataResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing technicians data...';
      
      try {
        const response = await fetch('/api/technicians');
        const data = await response.json();
        
        if (Array.isArray(data) && data.length > 0) {
          resultDiv.innerHTML = `
            <span class="status success">Success</span>
            <p>${data.length} technicians found.</p>
            <pre>${JSON.stringify(data.slice(0, 1), null, 2)}</pre>
          `;
        } else {
          resultDiv.innerHTML = `
            <span class="status warning">Warning</span>
            <p>No technicians found or invalid data format.</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to test technicians data: ${error.message}</p>
        `;
      }
    }
    
    // Test Relationships
    async function testRelationships() {
      const resultDiv = document.getElementById('relationshipsResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing entity relationships...';
      
      try {
        // Get clients
        const clientsResponse = await fetch('/api/clients');
        const clients = await clientsResponse.json();
        
        if (!Array.isArray(clients) || clients.length === 0) {
          resultDiv.innerHTML = `
            <span class="status warning">Warning</span>
            <p>No clients found to test relationships.</p>
          `;
          return;
        }
        
        // Get a client's maintenances
        const clientId = clients[0].id;
        const maintenancesResponse = await fetch(`/api/maintenances?clientId=${clientId}`);
        const maintenances = await maintenancesResponse.json();
        
        // Get projects
        const projectsResponse = await fetch('/api/projects');
        const projects = await projectsResponse.json();
        
        resultDiv.innerHTML = `
          <span class="status success">Success</span>
          <p>Entity relationships:</p>
          <ul>
            <li>Found ${clients.length} clients</li>
            <li>Client #${clientId} has ${Array.isArray(maintenances) ? maintenances.length : 'unknown'} maintenances</li>
            <li>Found ${Array.isArray(projects) ? projects.length : 'unknown'} projects</li>
          </ul>
          <p>Sample Client with User relationship:</p>
          <pre>${JSON.stringify({
            id: clients[0].id,
            name: clients[0].companyName || 'N/A',
            user: clients[0].user ? {
              id: clients[0].user.id,
              username: clients[0].user.username,
              email: clients[0].user.email
            } : 'No user data'
          }, null, 2)}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to test relationships: ${error.message}</p>
        `;
      }
    }
    
    // Test Dashboard Data
    async function testDashboardData() {
      const resultDiv = document.getElementById('dashboardResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div class="loader"></div> Testing dashboard data...';
      
      try {
        const response = await fetch('/api/dashboard/summary');
        const data = await response.json();
        
        if (data && data.metrics) {
          resultDiv.innerHTML = `
            <span class="status success">Success</span>
            <p>Dashboard data retrieved successfully:</p>
            <ul>
              <li>Active Projects: ${data.metrics.activeProjects}</li>
              <li>Maintenances This Week: ${data.metrics.maintenanceThisWeek}</li>
              <li>Pending Repairs: ${data.metrics.pendingRepairs}</li>
              <li>Total Clients: ${data.metrics.totalClients}</li>
            </ul>
            <p>Data includes:</p>
            <ul>
              <li>Recent Projects: ${Array.isArray(data.recentProjects) ? data.recentProjects.length : 0}</li>
              <li>Upcoming Maintenances: ${Array.isArray(data.upcomingMaintenances) ? data.upcomingMaintenances.length : 0}</li>
              <li>Recent Repairs: ${Array.isArray(data.recentRepairs) ? data.recentRepairs.length : 0}</li>
            </ul>
          `;
        } else {
          resultDiv.innerHTML = `
            <span class="status warning">Warning</span>
            <p>Dashboard data has unexpected format.</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">Error</span>
          <p>Failed to test dashboard data: ${error.message}</p>
        `;
      }
    }
    
    // Run the health check automatically on page load
    document.addEventListener('DOMContentLoaded', () => {
      testHealth();
    });
  </script>
</body>
</html>