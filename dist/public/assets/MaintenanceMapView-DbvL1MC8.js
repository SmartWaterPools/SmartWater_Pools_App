import{H as te,r as u,I as le,J as ie,j as e,K as re,L as F,h as H,o as O,m as Q,n as v,N as oe,f as T,C as ae,M as de,U as ce,O as ne,P as ue,Q as xe,T as ge,V as he,W as pe,X as me,Y as je}from"./index-CUDYyvPN.js";const fe={width:"100%",height:"600px"},k={lat:33.448376,lng:-82.041256};function Le({maintenances:r,isLoading:X=!1,selectedView:be,selectedTechnician:ye,selectedDay:Ne,onStatusUpdate:ve,isUpdatingStatus:Ce,selectedMaintenance:y}){var V,A,I,P,E,R,U,$,K,G,z,B,J,W,Z;const[,L]=te(),[t,N]=u.useState(y||null),[Y,we]=u.useState(!1),[m,M]=u.useState(null),[q,_]=u.useState(null);u.useEffect(()=>{y&&N(y)},[y]);const{apiKey:j,isLoaded:Te}=le();u.useEffect(()=>{console.log("MaintenanceMapView: Using API key from context:",j?"Valid key":"Empty key"),j&&_(j)},[j]);const{isLoaded:C}=ie({id:"google-map-script",googleMapsApiKey:j||"",libraries:["places"]}),ee=u.useCallback(s=>{M(s)},[]),se=u.useCallback(()=>{M(null)},[]),S=s=>{L(`/maintenance/${s}`)},w=u.useMemo(()=>{if(!(r!=null&&r.length)||!C)return null;const s=new google.maps.LatLngBounds;let l=!1;return r.forEach(i=>{var o,a,d,c;(a=(o=i.client)==null?void 0:o.client)!=null&&a.latitude&&((c=(d=i.client)==null?void 0:d.client)!=null&&c.longitude)&&(s.extend({lat:i.client.client.latitude,lng:i.client.client.longitude}),l=!0)}),l?s:null},[r,C]);if(u.useEffect(()=>{m&&w&&(m.fitBounds(w),r.length===1&&m.setZoom(14))},[m,w,r.length]),!C||X)return e.jsxs("div",{className:"flex justify-center items-center h-[600px] bg-gray-50 border rounded-lg",children:[e.jsx(re,{size:"lg"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading map..."})]});if(!q)return e.jsxs("div",{className:"flex flex-col justify-center items-center h-[600px] bg-gray-50 border rounded-lg",children:[e.jsx("p",{className:"text-red-500 mb-2",children:"Google Maps API key is not configured."}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please add your Google Maps API key to environment variables."})]});const D=()=>{L("/maintenance/routes")};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 w-full h-full",children:[e.jsxs("div",{className:"lg:col-span-1 bg-gray-50 p-3 rounded-lg border overflow-y-auto h-[600px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Scheduled Maintenances"}),e.jsxs("button",{onClick:D,className:"text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors py-1 px-2 rounded-md flex items-center",children:[e.jsx(F,{className:"h-3.5 w-3.5 mr-1"}),e.jsx("span",{children:"View Routes"})]})]}),r.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-gray-500",children:"No scheduled maintenances"}):e.jsx("div",{className:"space-y-3",children:r.map(s=>{var l,i,o,a,d,c,x;return e.jsx(H,{className:`cursor-pointer transition-all duration-200 ${(t==null?void 0:t.id)===s.id?"border-primary bg-primary/5":"hover:border-gray-300"}`,onClick:()=>{var n,g,h,p;N(s),m&&((g=(n=s.client)==null?void 0:n.client)!=null&&g.latitude)&&((p=(h=s.client)==null?void 0:h.client)!=null&&p.longitude)&&(m.panTo({lat:s.client.client.latitude,lng:s.client.client.longitude}),m.setZoom(15))},children:e.jsxs(O,{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-medium text-sm",children:((i=(l=s.client)==null?void 0:l.user)==null?void 0:i.name)||"Client"}),e.jsx(Q,{className:`${v(s.status).bg} ${v(s.status).text} text-xs`,children:s.status})]}),e.jsxs("div",{className:"mt-2 space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"h-3.5 w-3.5 mr-1.5 text-gray-500"}),e.jsx("span",{children:T(s.scheduleDate)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-3.5 w-3.5 mr-1.5 text-gray-500"}),e.jsx("span",{children:s.startTime?new Date(s.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Flexible"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"h-3.5 w-3.5 mr-1.5 text-gray-500"}),e.jsx("span",{className:"truncate",children:((a=(o=s.client)==null?void 0:o.user)==null?void 0:a.address)||s.client.address||((c=(d=s.client)==null?void 0:d.client)==null?void 0:c.address)||"No address"})]}),s.technician&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"h-3.5 w-3.5 mr-1.5 text-gray-500"}),e.jsx("span",{children:((x=s.technician.user)==null?void 0:x.name)||"Assigned Technician"})]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),S(s.id)},className:"w-full mt-2 py-1 px-2 bg-primary text-primary-foreground text-xs rounded-sm hover:bg-primary/90 transition-colors",children:"View Details"})]})},s.id)})})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(ne,{mapContainerStyle:fe,center:k,zoom:7,onLoad:ee,onUnmount:se,options:{disableDefaultUI:!1,zoomControl:!0,streetViewControl:!1,fullscreenControl:!0,mapTypeControl:!0},children:[e.jsx(ue,{children:s=>e.jsx("div",{children:r.map(l=>{var a,d,c,x,n,g,h,p,f,b;const i=((d=(a=l.client)==null?void 0:a.user)==null?void 0:d.latitude)||((c=l.client)==null?void 0:c.latitude)||((n=(x=l.client)==null?void 0:x.client)==null?void 0:n.latitude),o=((h=(g=l.client)==null?void 0:g.user)==null?void 0:h.longitude)||((p=l.client)==null?void 0:p.longitude)||((b=(f=l.client)==null?void 0:f.client)==null?void 0:b.longitude);return i&&o?e.jsx(xe,{position:{lat:i,lng:o},onClick:()=>N(l),clusterer:s},l.id):null})})}),r.map(s=>{var o,a,d,c,x,n,g,h,p,f,b;const l=((a=(o=s.client)==null?void 0:o.user)==null?void 0:a.latitude)||((d=s.client)==null?void 0:d.latitude)||((x=(c=s.client)==null?void 0:c.client)==null?void 0:x.latitude),i=((g=(n=s.client)==null?void 0:n.user)==null?void 0:g.longitude)||((h=s.client)==null?void 0:h.longitude)||((f=(p=s.client)==null?void 0:p.client)==null?void 0:f.longitude);return l&&i?e.jsx(ge,{children:e.jsxs(he,{children:[e.jsx(pe,{asChild:!0,children:e.jsx("div",{style:{position:"absolute",left:"-1000px",top:"-1000px"}})}),e.jsxs(me,{children:[e.jsx("div",{className:"font-medium",children:((b=s.client.user)==null?void 0:b.name)||"Client"}),e.jsx("div",{className:"text-xs",children:T(s.scheduleDate)})]})]})},`tooltip-${s.id}`):null}),t&&t.client&&e.jsx(je,{position:{lat:((A=(V=t.client)==null?void 0:V.user)==null?void 0:A.latitude)||((I=t.client)==null?void 0:I.latitude)||((E=(P=t.client)==null?void 0:P.client)==null?void 0:E.latitude)||k.lat,lng:((U=(R=t.client)==null?void 0:R.user)==null?void 0:U.longitude)||(($=t.client)==null?void 0:$.longitude)||((G=(K=t.client)==null?void 0:K.client)==null?void 0:G.longitude)||k.lng},onCloseClick:()=>N(null),children:e.jsx(H,{className:"w-72 border-none shadow-none",children:e.jsxs(O,{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:((z=t.client.user)==null?void 0:z.name)||"Client"}),e.jsx(Q,{className:`${v(t.status).bg} ${v(t.status).text}`,children:t.status})]}),e.jsxs("div",{className:"text-sm mb-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",((J=(B=t.client)==null?void 0:B.user)==null?void 0:J.address)||t.client.address||((Z=(W=t.client)==null?void 0:W.client)==null?void 0:Z.address)||"No address"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",T(t.scheduleDate)]}),t.startTime&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Time:"})," ",new Date(t.startTime).toLocaleTimeString()]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>S(t.id),className:"flex-1 py-1 px-2 bg-primary text-primary-foreground text-sm rounded-md hover:bg-primary/90 transition-colors",children:"View Details"}),e.jsxs("button",{onClick:()=>D(),className:"py-1 px-2 bg-blue-50 text-blue-600 hover:bg-blue-100 text-sm rounded-md flex items-center transition-colors",children:[e.jsx(F,{className:"h-3.5 w-3.5 mr-1"}),"Routes"]})]})]})})}),Y&&null]})})]})}export{Le as MaintenanceMapView};
