import{r as as,u as cs,a as hs,b as ts,R as G,f as I,j as s,S as T,D as A,c as F,B as w,d as E,e as a,g as P,C,h as S,i as q,k as L,l as R,M as V,m as K,n as H,o as O,U as Q,p as J,q as X,s as W,t as Y,v as D,w as Z,F as U,E as M,x as ss,y as es,z as rs,A as ls,G as xs}from"./index-CUDYyvPN.js";function js({maintenances:p,isLoading:is,onStatusUpdate:c,isUpdatingStatus:t,selectedMaintenance:l}){const[x,N]=as.useState(null),{data:_=[],isLoading:$}=cs({queryKey:["/api/technicians"],staleTime:5*60*1e3}),{toast:B}=hs(),v=ts({mutationFn:async({maintenanceId:e,technicianId:i})=>{const r=await fetch(`/api/maintenances/${e}/technician`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({technicianId:i})});if(!r.ok){const d=await r.json();throw new Error(d.message||"Failed to update technician")}return r.json()},onSuccess:()=>{B({title:"Technician updated",description:"Maintenance assignment has been updated successfully."}),xs.invalidateQueries({queryKey:["/api/maintenances"]})},onError:e=>{B({title:"Error",description:`Failed to update technician: ${e.message}`,variant:"destructive"})}}),y=G.useMemo(()=>p.filter(e=>e.technicianId&&!e.startTime&&e.status==="scheduled"),[p]),ds=G.useMemo(()=>{const e=x===null?p.filter(i=>!(i.technicianId&&!i.startTime&&i.status==="scheduled")):p;return x?e.reduce((i,r)=>{var o,j,n,u;let d;switch(x){case"date":d=I(r.scheduleDate);break;case"status":d=r.status.charAt(0).toUpperCase()+r.status.slice(1).replace("_"," ");break;case"client":d=((j=(o=r.client)==null?void 0:o.user)==null?void 0:j.name)||"Unknown Client";break;case"technician":d=((u=(n=r.technician)==null?void 0:n.user)==null?void 0:u.name)||"Unassigned";break;default:d="All Maintenance"}return i[d]||(i[d]=[]),i[d].push(r),i},{}):{"All Maintenance":e}},[p,x,y]),z=e=>e.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ");return is?s.jsx("div",{className:"space-y-4",children:Array(5).fill(0).map((e,i)=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(T,{className:"h-6 w-32"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:[s.jsx(T,{className:"h-28 w-full rounded-lg"}),s.jsx(T,{className:"h-28 w-full rounded-lg"}),s.jsx(T,{className:"h-28 w-full rounded-lg"})]})]},i))}):p.length?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex justify-end mb-4",children:s.jsxs(A,{children:[s.jsx(F,{asChild:!0,children:s.jsx(w,{variant:"outline",children:x?`Group by: ${x.charAt(0).toUpperCase()+x.slice(1)}`:"Group by"})}),s.jsxs(E,{align:"end",children:[s.jsx(a,{onClick:()=>N(null),children:"No Grouping"}),s.jsx(P,{}),s.jsx(a,{onClick:()=>N("date"),children:"Date"}),s.jsx(a,{onClick:()=>N("status"),children:"Status"}),s.jsx(a,{onClick:()=>N("client"),children:"Client"}),s.jsx(a,{onClick:()=>N("technician"),children:"Technician"})]})]})}),y.length>0&&x===null&&s.jsxs("div",{className:"border border-amber-300 bg-amber-50 rounded-lg p-4 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(C,{className:"h-5 w-5 text-amber-500"}),s.jsxs("h3",{className:"text-lg font-medium text-amber-700",children:["Assigned But Not Routed (",y.length,")"]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:y.map(e=>{var i,r,d,o,j,n,u,f,b;return s.jsxs(S,{className:"overflow-hidden border-amber-200",children:[s.jsx(q,{className:"pb-2 bg-amber-50",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx(L,{className:"text-base",children:(r=(i=e.client)==null?void 0:i.user)==null?void 0:r.name}),s.jsxs(R,{className:"text-xs flex items-center mt-1",children:[s.jsx(V,{className:"h-3 w-3 mr-1"}),((o=(d=e.client)==null?void 0:d.user)==null?void 0:o.address)||((n=(j=e.client)==null?void 0:j.client)==null?void 0:n.address)||"No address"]})]}),s.jsx("div",{children:e.status&&s.jsx(K,{className:H(e.status).bg,children:e.status.replace("_"," ")})})]})}),s.jsxs(O,{className:"pb-2",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(C,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:I(e.scheduleDate)})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),$?s.jsx("span",{children:((b=(f=e.technician)==null?void 0:f.user)==null?void 0:b.name)||"Unassigned"}):s.jsxs(J,{value:((u=e.technicianId)==null?void 0:u.toString())||"unassigned",onValueChange:h=>{const m=h==="unassigned"?null:parseInt(h,10);v.mutate({maintenanceId:e.id,technicianId:m})},disabled:v.isPending,children:[s.jsx(X,{className:"h-7 w-[130px] text-xs",children:s.jsx(W,{placeholder:"Select technician"})}),s.jsxs(Y,{children:[s.jsx(D,{value:"unassigned",children:"Unassigned"}),_.map(h=>{var m;return s.jsx(D,{value:h.id.toString(),children:((m=h.user)==null?void 0:m.name)||`Technician #${h.id}`},h.id)})]})]})]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-sm font-medium",children:"Type: "}),s.jsx("span",{className:"text-sm",children:z(e.type)})]}),e.notes&&s.jsxs("div",{className:"mt-2 text-sm",children:[s.jsx("span",{className:"font-medium",children:"Notes: "}),s.jsx("span",{className:"text-muted-foreground",children:e.notes.length>100?`${e.notes.substring(0,100)}...`:e.notes})]})]}),s.jsxs(Z,{className:"pt-2 flex justify-between",children:[s.jsxs(w,{variant:"outline",size:"sm",children:[s.jsx(U,{className:"h-4 w-4 mr-1"}),"Details"]}),s.jsxs(A,{children:[s.jsx(F,{asChild:!0,children:s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",children:s.jsx(M,{className:"h-4 w-4"})})}),s.jsxs(E,{align:"end",children:[s.jsx(ss,{children:"Actions"}),c&&s.jsxs(s.Fragment,{children:[s.jsx(P,{}),s.jsxs(a,{onClick:()=>c(e,"scheduled"),disabled:t&&(l==null?void 0:l.id)===e.id,children:[s.jsx(C,{className:"h-4 w-4 mr-2"}),"Mark as Scheduled"]}),s.jsxs(a,{onClick:()=>c(e,"in_progress"),disabled:t&&(l==null?void 0:l.id)===e.id,children:[s.jsx(es,{className:"h-4 w-4 mr-2"}),"Mark as In Progress"]}),s.jsxs(a,{onClick:()=>c(e,"completed"),disabled:t&&(l==null?void 0:l.id)===e.id,children:[s.jsx(rs,{className:"h-4 w-4 mr-2"}),"Mark as Completed"]}),s.jsxs(a,{onClick:()=>c(e,"cancelled"),disabled:t&&(l==null?void 0:l.id)===e.id,children:[s.jsx(ls,{className:"h-4 w-4 mr-2"}),"Mark as Cancelled"]})]})]})]})]})]},e.id)})})]}),Object.entries(ds).map(([e,i])=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-lg font-medium",children:e}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:i.map(r=>{var d,o,j,n,u,f,b,h,m;return s.jsxs(S,{className:"overflow-hidden",children:[s.jsx(q,{className:"pb-2",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx(L,{className:"text-base",children:(o=(d=r.client)==null?void 0:d.user)==null?void 0:o.name}),s.jsxs(R,{className:"text-xs flex items-center mt-1",children:[s.jsx(V,{className:"h-3 w-3 mr-1"}),((n=(j=r.client)==null?void 0:j.user)==null?void 0:n.address)||((f=(u=r.client)==null?void 0:u.client)==null?void 0:f.address)||"No address"]})]}),s.jsx("div",{children:r.status&&s.jsx(K,{className:H(r.status).bg,children:r.status.replace("_"," ")})})]})}),s.jsxs(O,{className:"pb-2",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(C,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:I(r.scheduleDate)})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),$?s.jsx("span",{children:((m=(h=r.technician)==null?void 0:h.user)==null?void 0:m.name)||"Unassigned"}):s.jsxs(J,{value:((b=r.technicianId)==null?void 0:b.toString())||"unassigned",onValueChange:g=>{const k=g==="unassigned"?null:parseInt(g,10);v.mutate({maintenanceId:r.id,technicianId:k})},disabled:v.isPending,children:[s.jsx(X,{className:"h-7 w-[130px] text-xs",children:s.jsx(W,{placeholder:"Select technician"})}),s.jsxs(Y,{children:[s.jsx(D,{value:"unassigned",children:"Unassigned"}),_.map(g=>{var k;return s.jsx(D,{value:g.id.toString(),children:((k=g.user)==null?void 0:k.name)||`Technician #${g.id}`},g.id)})]})]})]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-sm font-medium",children:"Type: "}),s.jsx("span",{className:"text-sm",children:z(r.type)})]}),r.notes&&s.jsxs("div",{className:"mt-2 text-sm",children:[s.jsx("span",{className:"font-medium",children:"Notes: "}),s.jsx("span",{className:"text-muted-foreground",children:r.notes.length>100?`${r.notes.substring(0,100)}...`:r.notes})]})]}),s.jsxs(Z,{className:"pt-2 flex justify-between",children:[s.jsxs(w,{variant:"outline",size:"sm",children:[s.jsx(U,{className:"h-4 w-4 mr-1"}),"Details"]}),s.jsxs(A,{children:[s.jsx(F,{asChild:!0,children:s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",children:s.jsx(M,{className:"h-4 w-4"})})}),s.jsxs(E,{align:"end",children:[s.jsx(ss,{children:"Actions"}),c&&s.jsxs(s.Fragment,{children:[s.jsx(P,{}),s.jsxs(a,{onClick:()=>c(r,"scheduled"),disabled:t&&(l==null?void 0:l.id)===r.id,children:[s.jsx(C,{className:"h-4 w-4 mr-2"}),"Mark as Scheduled"]}),s.jsxs(a,{onClick:()=>c(r,"in_progress"),disabled:t&&(l==null?void 0:l.id)===r.id,children:[s.jsx(es,{className:"h-4 w-4 mr-2"}),"Mark as In Progress"]}),s.jsxs(a,{onClick:()=>c(r,"completed"),disabled:t&&(l==null?void 0:l.id)===r.id,children:[s.jsx(rs,{className:"h-4 w-4 mr-2"}),"Mark as Completed"]}),s.jsxs(a,{onClick:()=>c(r,"cancelled"),disabled:t&&(l==null?void 0:l.id)===r.id,children:[s.jsx(ls,{className:"h-4 w-4 mr-2"}),"Mark as Cancelled"]})]})]})]})]})]},r.id)})})]},e))]}):s.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:s.jsxs("div",{className:"text-center space-y-3",children:[s.jsx("h3",{className:"text-lg font-medium",children:"No maintenance records found"}),s.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your filters or adding new maintenance records."})]})})}export{js as MaintenanceListView,js as default};
